generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum ErrorSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum ErrorSource {
  API
  DATABASE
  AUTH
  SYSTEM
  EXTERNAL_SERVICE
}

enum LogLevel {
  INFO
  WARN
  ERROR
  DEBUG
}

enum Role {
  SuperAdmin
  DivisionAdmin
  DistrictAdmin
  UpazilaAdmin
  LabAdmin
  Anonymous
}

enum PageState {
  Default
  SendVerifiedEmailCode
  VerifiedEmail
  Registered
}

model VisitorLog {
  id            String    @id @default(uuid())
  level         LogLevel
  message       String

  requestId     String?
  method        String?
  path          String?
  statusCode    Int?
  durationMs    Int?
  ip            String?
  userAgent     String?
  device        String?

  service       String    @default("api")
  environment   String    @default("development")
  timezone      String    @default("Asia/Dhaka")
  createdAt     DateTime  @default(now())

  @@index([level])
  @@index([createdAt])
  @@index([requestId, createdAt])
}

model ErrorLog {
  id            String        @id @default(uuid())

  message       String
  errorCode     String?
  stackTrace    String?
  severity      ErrorSeverity
  source        ErrorSource

  requestId     String?
  method        String?
  path          String?
  statusCode    Int?
  durationMs    Int?

  ip            String?
  userAgent     String?
  device        String?

  service       String        @default("api")
  environment   String        @default("development")
  timezone      String        @default("Asia/Dhaka")
  occurredAt    DateTime      @default(now())

  @@index([severity])
  @@index([source])
  @@index([occurredAt])
  @@index([requestId, occurredAt])
}

model User {
  id                     String    @id @default(uuid()) @db.Uuid @unique
  userName               String?              // taken
  email                  String    @unique   // taken
  password               String    @default("govt@doict.pass")
  phoneNumber            String?   @unique  // taken
  altPhoneNumber         String?   @unique  // taken?
  imageUrl               String    @default("https://www.iconpacks.net/icons/2/free-user-icon-3296-thumb.png")

  usersManagementKey     String?   @unique
  pageState              PageState @default(Default)

  isVerified             Boolean   @default(false)
  role                   Role?      @default(LabAdmin) //taken

  verificationCode       String?
  verificationExpiry     DateTime?

  resetPasswordCode      String?
  resetPasswordExpires   DateTime?

  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt

  labs                   labs[]
}


enum LabTypes {
  sof
  ictdl_sof
  srdl_sof
}
model labs {
  id         Int        @id @default(autoincrement())
  division   String?    @db.VarChar(255)
  seat       String?    @db.VarChar(255)
  upazila    String?    @db.VarChar(255)
  institute  String?    @db.VarChar(255)
  lab_type   LabTypes?

  userId     String     @db.Uuid
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  lat        String?
  long       String?

  @@index([division], map: "idx_labs_division")
  @@index([lab_type], map: "idx_labs_lab_type")
  @@index([upazila], map: "idx_labs_upazila")
  @@index([userId])
}